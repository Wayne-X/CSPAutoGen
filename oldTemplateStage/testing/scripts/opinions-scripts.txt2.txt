/*jshintbrowser:true,maxparams:8,node:false*//*globalsjQuery,CNN,Modernizr*/'usestrict';jQuery(function(){/***Capturethe"timetofirstvideoframe",fromstartofthepageloadtowhenCVPinitializes,andpassthevaluetoAspen.*Onlyforautostartvideos.*PertheCVPTeam:*writeSessionId(string)iscalledimmediatelyaftertheAspenhelloresponse.*Becauseallthetiminginfowe'repiecingtogetherontheAspensidestartswiththehello,*writeSessionIdisthebestplacetostopthepagetimingtoavoiddatagapsandoverlap.*Note,writeSessionIdisnotaCVPcallbackliketheothers,butisinsteadcalledontheglobalspace.*ItalsoonlyexistsonFlashcurrently.*-assoonaspossible,startapagetimer*-whenwriteSessionIdiscalled,stopthetimer*-inonCVPReadycallback,callreportAnalyticstosendthedata*/functioncaptureTimeToFirstVideoFrame(){if(typeofCNN.VideoPlayer.pageLoadStartTime==='undefined'){CNN.VideoPlayer.pageLoadStartTime=newDate();}window.writeSessionId=functionwriteSessionId(string){CNN.VideoPlayer.setLoadTime();};CNN.VideoPlayer.setLoadTime=functionsetLoadTime(){if(CNN.autoPlayVideoExist===true&&typeofCNN.VideoPlayer.loadTime==='undefined'){CNN.VideoPlayer.writeSessionIdCallTime=newDate();CNN.VideoPlayer.loadTime=CNN.VideoPlayer.writeSessionIdCallTime-CNN.VideoPlayer.pageLoadStartTime;}};/***Reportstheloadtimetoanalytics*CalledbyCVP'sonPlayerReadycallback*/CNN.VideoPlayer.reportLoadTime=functionreportLoadTime(containerId){varcvp;if(CNN.autoPlayVideoExist===true&&typeofCNN.Utils.exists(CNN.VideoPlayer.loadTime)){cvp=containerId&&window.cnnVideoManager.getPlayerByContainer(containerId).videoInstance.cvp||null;if(CNN.Utils.existsObject(cvp)){cvp.reportAnalytics('videoPageTiming',{pageLoad:CNN.VideoPlayer.loadTime});}}};}captureTimeToFirstVideoFrame();CNN.VideoPlayer.showSpinner=functionshowSpinner(containerId){if(Modernizr&&!Modernizr.phone&&!Modernizr.mobile&&!Modernizr.tablet){jQuery(document.getElementById(('spinner_'+containerId).replace('#',''))).show();}};CNN.VideoPlayer.hideSpinner=functionhideSpinner(containerId){if(Modernizr&&!Modernizr.phone&&!Modernizr.mobile&&!Modernizr.tablet){jQuery(document.getElementById(('spinner_'+containerId).replace('#',''))).hide();}};CNN.VideoPlayer.hideThumbnail=functionhideThumbnail(containerId){if(Modernizr&&!Modernizr.phone&&!Modernizr.mobile&&!Modernizr.tablet){jQuery(document.getElementById(containerId+'--thumbnail')).hide();}};CNN.autoPlayVideoExist=(CNN.autoPlayVideoExist===true)?true:false;varconfigObj={thumb:'none',video:'tv/2015/04/21/climate-change-2-degrees-celsius-global-warming-orig.cnn',width:'100%',height:'100%',section:'domestic',profile:'expansion',network:'cnn',markupId:'card_326AC701-D695-563F-F9E5-B8730CE84FB8_0',frameWidth:'100%',frameHeight:'100%'},autoStartVideo=false,callbackObj,currentVideoCollection=[],currentVideoCollectionId='',moveToNextTimeout,nextVideoId='',nextVideoUrl='',videoPinner,videoEndSlateImpl;if(CNN.autoPlayVideoExist===false){if(autoStartVideo){CNN.autoPlayVideoExist=true;}}configObj.autostart=autoStartVideo;videoEndSlateImpl=newCNN.VideoEndSlate('card_326AC701-D695-563F-F9E5-B8730CE84FB8_0');/***FindsthenextvideoIDandURLinthecurrentcollection,ifavailable.*@paramcurrentVideoIdThevideothatiscurrentlyplaying*@paramcontainerIdTheparentcontainerIdofthevideoelement*/functionfindNextVideo(currentVideoId){vari,vidObj;if(currentVideoId&&jQuery.isArray(currentVideoCollection)&&currentVideoCollection.length>0){for(i=0;i<currentVideoCollection.length;i++){vidObj=currentVideoCollection[i];if(typeofvidObj!=='undefined'&&vidObj.videoId===currentVideoId){if(i<currentVideoCollection.length-1){nextVideoId=currentVideoCollection[i+1].videoId;nextVideoUrl=currentVideoCollection[i+1].videoUrl;}else{nextVideoId=currentVideoCollection[0].videoId;nextVideoUrl=currentVideoCollection[0].videoUrl;}break;}}if(!nextVideoUrl){nextVideoId=currentVideoCollection[0].videoId;nextVideoUrl=currentVideoCollection[0].videoUrl;}currentVideoCollectionId=(window.jsmd&&window.jsmd.v&&window.jsmd.v.eVar60)||nextVideoUrl.replace(/^.+\/video\/playlists\/(.+)\//,'$1');}else{nextVideoId='';nextVideoUrl='';}}findNextVideo('tv/2015/04/21/climate-change-2-degrees-celsius-global-warming-orig.cnn');/***Navigatestothevideoleafpageofthenextvideointhecurrentcollection,ifavailable.*@paramcurrentVideoIdThevideothatiscurrentlyplaying*@paramcontainerIdTheparentcontainerIdofthevideoelement*/functionnavigateToNextVideo(currentVideoId,containerId){var$endSlate,nextVideoPlayTimeout=1500;findNextVideo(currentVideoId);if(nextVideoUrl){moveToNextTimeout=setTimeout(function(){location.href=nextVideoUrl;},nextVideoPlayTimeout);}else{$endSlate=jQuery(document.getElementById(containerId)).parent().find('.js-video__end-slate').eq(0);if($endSlate.length>0){videoEndSlateImpl.showEndSlateForContainer();}}}callbackObj={onPlayerReady:function(containerId){CNN.VideoPlayer.reportLoadTime(containerId);CNN.VideoPlayer.handleAdOnCVPVisibilityChange(containerId,CNN.pageVis.isDocumentVisible());if(Modernizr&&!Modernizr.phone&&!Modernizr.mobile&&!Modernizr.tablet){varcontainerClassId='#'+containerId;if(jQuery(containerClassId).parents('.js-pg-rail-tall__head').length){videoPinner=newCNN.VideoPinner(containerClassId);videoPinner.init();}else{CNN.VideoPlayer.hideThumbnail(containerId);}}},/**Listentothemetadataeventwhichfiresrightaftertheadendsandtheactualvideoplaybackbegins*/onContentEntryLoad:function(containerId,playerId,contentid,isQueue){CNN.VideoPlayer.showSpinner(containerId);},onContentMetadata:function(containerId,playerId,metadata,contentId,duration,width,height){varendSlateLen=jQuery(document.getElementById(containerId)).parent().find('.js-video__end-slate').eq(0).length;CNN.VideoSourceUtils.updateSource(containerId,metadata);if(endSlateLen>0){videoEndSlateImpl.fetchAndShowRecommendedVideos(metadata);}},onAdPlay:function(containerId,cvpId,token,mode,id,duration,blockId,adType){clearTimeout(moveToNextTimeout);/*AddaVisualRevenueeventonvideoadstart*/if(Array.isArray(window._vrq)){window._vrq.push(['video','adroll',configObj.video]);}if(blockId===0){(newImage()).src="http://traffic.outbrain.com/network/trackpxl?advid=814&amp;action=view";}CNN.VideoPlayer.hideSpinner(containerId);if(Modernizr&&!Modernizr.phone&&!Modernizr.mobile&&!Modernizr.tablet){if(typeofvideoPinner!=='undefined'&&videoPinner!==null){videoPinner.setIsPlaying(true);videoPinner.animateDown();}}},onAdEnd:function(containerId,cvpId,token,mode,id,blockId,adType){/*AddaVisualRevenueeventonvideoadstop*/if(Array.isArray(window._vrq)){window._vrq.push(['video','adstop',configObj.video]);}},onContentPlay:function(containerId,cvpId,event){/**Whenthevideocontentstartsplaying,injectanalyticsdata*forAspen(ifenabled)andthecompanionadlayout*(ifitwassetwhentheadplayed)shouldswitchbackto*epicadlayout.onContentPlaycallsupdateCompanionLayout*withthe'restoreEpicAds'layouttomakethisswitch*/if(CNN.companion&&typeofCNN.companion.updateCompanionLayout==='function'){CNN.companion.updateCompanionLayout('restoreEpicAds');}clearTimeout(moveToNextTimeout);CNN.VideoPlayer.hideSpinner(containerId);/*AddaVisualRevenueeventonvideostart*/if(Array.isArray(window._vrq)){window._vrq.push(['video','play',configObj.video]);}varcvp=containerId&&window.cnnVideoManager.getPlayerByContainer(containerId).videoInstance.cvp||null,prevVideoId=(window.jsmd&&window.jsmd.v&&(window.jsmd.v.eVar18||window.jsmd.v.eVar4))||'';if(cvp&&typeofcvp.reportAnalytics==='function'){if(prevVideoId.length===0&&document.referrer&&document.referrer.search(/\/videos\//)>=0){prevVideoId=document.referrer.replace(/^(?:http|https)\:\/\/[^\/]\/videos\/(.+\.\w+)(?:\/video\/playlists\/.*)?$/,'/video/$1');if(prevVideoId===document.referrer){prevVideoId='';}}cvp.reportAnalytics('videoPageData',{videoCollection:currentVideoCollectionId,videoBranding:CNN.omniture.branding_content_page,templateType:CNN.omniture.template_type,nextVideo:nextVideoId,previousVideo:prevVideoId,referrerType:'',referrerUrl:document.referrer});}if(Modernizr&&!Modernizr.phone&&!Modernizr.mobile&&!Modernizr.tablet){if(typeofvideoPinner!=='undefined'&&videoPinner!==null){videoPinner.setIsPlaying(true);videoPinner.animateDown();}}},onContentReplayRequest:function(containerId,cvpId,contentId){if(Modernizr&&!Modernizr.phone&&!Modernizr.mobile&&!Modernizr.tablet){if(typeofvideoPinner!=='undefined'&&videoPinner!==null){videoPinner.setIsPlaying(true);var$endSlate=jQuery(document.getElementById(containerId)).parent().find('.js-video__end-slate').eq(0);if($endSlate.length>0){$endSlate.removeClass('video__end-slate--active').addClass('video__end-slate--inactive');}}}},onContentBegin:function(containerId,cvpId,contentId){/**Beforethevideoadstarts,thefreewheelcompanionad*htmlneedstobeplacedonthepagesothatitcanbe*triggeredbyFreewheeltodisplaythecompanionad.*onContentBegintriggersupdateCompanionLayoutwhich*handlesthelogictoswitchfromepictocompanionads*withthe'removeEpicAds'layout*/if(CNN.companion&&typeofCNN.companion.updateCompanionLayout==='function'){CNN.companion.updateCompanionLayout('removeEpicAds');}CNN.VideoPlayer.hideSpinner(containerId);clearTimeout(moveToNextTimeout);CNN.VideoSourceUtils.clearSource(containerId);},onContentComplete:function(containerId,cvpId,contentId){/**Whenthevideoiscompletelydonethenrestorethe*freewheeltagtothepage.Theepictagswerealready*addedtothepagewhenthevideocontentbeganplaying*aftertheadplayedusingtheonContentPlayevent.*/if(CNN.companion&&typeofCNN.companion.updateCompanionLayout==='function'){CNN.companion.updateCompanionLayout('restoreFreewheel');}navigateToNextVideo(contentId,containerId);},onContentEnd:function(containerId,cvpId,contentId){/*AddaVisualRevenueeventonvideoend*/if(Array.isArray(window._vrq)){window._vrq.push(['video','stop',configObj.video]);}if(Modernizr&&!Modernizr.phone&&!Modernizr.mobile&&!Modernizr.tablet){if(typeofvideoPinner!=='undefined'&&videoPinner!==null){videoPinner.setIsPlaying(false);}}},onCVPVisibilityChange:function(containerId,cvpId,visible){CNN.VideoPlayer.handleAdOnCVPVisibilityChange(containerId,visible);}};if(typeofconfigObj.context!=='string'||configObj.context.length<=0){configObj.context='opinions'.replace(/[\(\)\-]/g,'');}if(typeofwindow.ssid==='string'&&window.ssid.length>0){configObj.adsection=window.ssid;}if(typeofconfigObj.adsection==='undefined'&&typeofwindow.ssid==='string'&&window.ssid.length>0){configObj.adsection=window.ssid;}if(CNN.VideoPlayer.apiInitialized){window.cnnVideoManager.renderMultipleContainers({videoConfig:configObj,eventsCallback:callbackObj});}else{CNN.VideoPlayer.addVideo(configObj,callbackObj);}});